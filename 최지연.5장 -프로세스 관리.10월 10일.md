## 5장 프로세스 관리

### 1. 프로세스의 개념
`프로세스(process)` : 실행 중인 프로그램(program in execution). 디스크에 실행파일 형태로 존재하던 프로그램이 메모리에 올라가서 실행되기 시작한 상태.    
`프로세스 문맥(context)` : 프로세스가 현재 어떤 상태에서 수행되고 있는지 정확히 규명하기 위해 필요한 정보를 의미    

여러 프로세스가 함께 수행되는 시분할 시스템 환경   
-> timer interrrupt에 의해 짧은 시간 동안 CPU를 빼앗겼다가 추후에 다시 획득하는 식으로 CPU관리가 이루어짐    
-> 따라서, CPU를 다시 획득해 명령 수행을 재개하는 시점이 되면 '직전 수행 시점의 정확한 상태'를 재현할 필요가 있고, 이를 위한 정보가 프로세스 문맥이다.     

프로세스 문맥을 크게 세 가지로 분류하면 하드웨어 문맥, 프로세스의 주소 공간, 커널상의 문맥으로 나누어볼 수 있다.   
- 하드웨어 문맥 : CPU의 수행상태를 나타냄. 프로그램 카운터(PC)값과 각종 레지스터에 저장하고 있는 값들을 의미     
-프로세스의 주소 공간 : 코드, 데이터, 스택으로 구성    
- 커널상의 문맥 : PCB와 커널스택     

### 2. 프로세스의 상태    
프로세스의 상태는 실행(running), 준비(ready), 봉쇄(blocked, wait, sleep)의 세 가지로 구분할 수 있다.      
- 실행(running) : 프로세스가 CPU를 보유하고, 기계어 명령을 실행하고 있는 상태    
- 준비(ready) : 프로세스가 CPU만 보유하면 당장 명령을 실행할 수 있지만 CPU를 할당받지 못한 상태        
- 봉쇄(blocked, wait, sleep) : CPU를 할당받더라도 당장 명령을 실행할 수 없는 상태 

 ++ 일시적인 상태   
 - 시작(new) : 프로세스가 시작되어 그 프로세스를 위한 각종 자료구조는 생성되었지만 아직 메모리 획득을 승인받지 못한 상태     
 - 완료(terminated) : 프로세스가 종료되었으나 운영체제가 그 프로세스와 관련된 자료구조를 완전히 정리하지 못한 상태    

프로세스는 어느 한 상태에 머물러 있게 되며, 시간이 흐름에 따라 상태가 변하게 된다.    

> 타이머 인터럽트가 발생한 프로세스의 상태 변화  
타이머 인터럽트가 발생하면 CPU의 제어권은 운영체제로 이양된다.    
운영체제는 타이머 인터럽트 처리루틴으로 가서 수행 중이던 프로세스의 문맥을 저장하고, 준비 상태에 있는 프로세스 중에서 새롭게 CPU의 제어권을 부여할 프로세스를 선택한다.    
원래 수행 중이던 프로세스는 준비 상태로 변하고, 새롭게 CPU를 할당받은 프로세스가 실행 상태가 된다.     

- CPU 디스패치(dispatch) : 준비 상태에 있는 프로세스들 중에서 CPU를 할당받을 프로세스를 선택한 후 실제로 CPU의 제어권을 넘겨받는 과정

> 입출력을 요청한 프로세스의 상태 변화      
디스크 입출력이 진행되는 동안에는 해당 프로세스가 CPU를 점유하고 있어도 후속명령을 처리하지 못해서 CPU가 낭비될 수 있기 때문에 해당 프로세스는 봉쇄 상태로 바뀐다.    
CPU를 기다리는 준비 상태의 프로세스들 중에서 CPU 스케줄러가 적절한 프로세스를 하나 선정해 CPU를 할당하게 된다. CPU를 할당받은 프로세스는 실행 상태로 변경되어 자신의 코드를 CPU에서 실행하게 된다.    

### 3. 프로세스 제어블록    
`프로세스 제어블록(Process Control Block : PCB)` 이란 운영체제가 시스템 내의 프로세스들을 관리하기 위해 프로세스마다 유지하는 정보들을 담는 커널 내의 자료구조를 뜻한다. 
PCB는 다음과 같은 요소들로 구성되어 있다.      

- 프로세스의 상태 : CPU를 할당해도 되는지 여부
- 프로그램 카운터의 값 : 다음에 수행할 명령의 위치 가리킴     
- CPU 레지스터 : CPU 연산을 위해 현 시점에 레지스터에 어떤 값을 저장하고 있는지    
- CPU 프케줄링 정보 : 프로세스의 CPU 스케줄링을 위해 필요한 정보     
- 메모리 관리 정보 : 메모리 할당을 위해 필요한 정보   
- 자원 사용 정보 : 사용자에게 자원 사용 요금을 계산해 청구하는 등의 용도    
- 입출력 상태 정보 : 프로세스가 오픈한 파일 정보 등 프로세스와 관련된 입출력 관련 상태 정보     

### 4. 문맥교환    
문맥교환이란 하나의 사용자 프로세스로부터 다른 사용자 프로세스로 CPU의 제어권이 이양되는 과정을 뜻한다.   

- 문맥교환 중에 원래 CPU를 보유하고 있던 프로세스는 프로그램 카운터값 등 프로세스의 문맥을 자신의 PCB에 저장하고, 새롭게 CPU를 할당받을 프로세스는 예전에 저장했던 자신의 문맥을 PCB로부터 실제 하드웨어로 복원시키는 과정을 거친다.      

- 프로세스가 실행 상태일 때 시스템 콜이나 인터럽트가 발생하면 CPU의 제어권이 운영체제로 넘어와 원래 실행 중이던 프로세스의 업무를 잠시 멈추고 운영체제 커널의 코드가 실행된다. 이 과정은 문맥교환이라 하지 않는다. 단순히 사용자모드에서 커널모드로 바뀌는 것일 뿐이다.      

### 5. 프로세스를 스케줄링하기 위한 큐    
- 운영체제는 준비 상태에 있는 프로세스들을 줄 세우기 위해 준비 큐(ready queue)를 두고 준비 큐의 제일 앞에 줄 서 있는 프로세스에 제일 먼저 CPU를 할당한다.       
- 운영체제는 특정 자원을 기다리는 프로세스들을 줄 세우기 위해 자원별로 장치 큐를 둔다.       
- 소프트웨어 자원(데이터에 대한 접근 권한)을 기다리는 경우에도 큐가 필요하다.     

### 6. 스케줄러    
- `스케줄러` 란 어떤 프로세스에게 자원을 할당할지를 결정하는 운영체제 커널의 코드를 지칭한다. 스케줄러에는 장기 스케줄러와 단기 스케줄러가 있다.      

- 장기 스케줄러      
작업 스케줄러라고도 부른다. 어떤 프로세스를 준비 큐에 진입시킬지 결정하는 역할을 한다.     
메모리에 동시에 올라가 있는 프로세스의 수를 조절하는 역할을 한다.     
하지만, 현대의 시분할 시스템에서 사용되는 운영체제에는 일반적으로 장기 스케줄러를 두지 않는 경우가 대부분이다.   

- 중기 스케줄러    
현대에는 장기 스케줄러보다 중기 스케줄러를 두는 경우가 많다.     
지나치게 많은 프로세스에의 메모리 할당으로 인한 시스템 성능 저하를 해결하기 위해 메모리에 적재된 프로세스의 수를 동적으로 조절하기 위해 추가된 스케줄러이다.      
중기 스케줄러는 프로세스당 보유 메모리양이 지나치게 적어진 경우 이를 완화시키기 위해 일부 프로세스를 메모리에서 디스크로 스왑 아웃시키는 역할을 수행한다.      

- 단기 스케줄러      
CPU 스케줄러라고도 한다. 준비 상태의 프로세스 중에서 어떤 프로세스를 다음번에 실행 상태로 만들 것인지 결정한다.    
시분할 시스템에서는 타이머 인터럽트가 발생하면 단기 스케줄러가 호출된다.    

### 8. 프로세스의 협력    
운영체제는 프로세스 간의 협력 메커니즘을 제공해 하나의 프로세스가 다른  프로세스의 수행에 영향을 미칠 수 있게 한다. 운영체제가 제공하는 대표적인 메커니즘으로는 IPC(Inter-Process Communication)가 있다. IPC는 프로세스들 간의 통신과 동기화를 이루기 위한 메커니즘을 의미한다. 대표적인 방법으로는 `메세지 전달 방식` 과 `공유메모리 방식` 이 있으며, 두 가지 방식의 차이는 프로세스 사이에 공유 데이터를 사용하는지 여부에 있다.    
